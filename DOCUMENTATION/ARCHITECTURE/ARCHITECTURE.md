# Архитектура Azhur Katering

## Основные функции

### Для пользователей:
- **Регистрация и авторизация** с email верификацией
- **Просмотр меню блюд** с фильтрацией по категориям
- **Добавление блюд в корзину** с сохранением между сессиями
- **Оформление заказов** с указанием доставки
- **Просмотр истории заказов** в личном кабинете (на рассмотрение)
- **Оставление отзывов**

### Для администраторов:
- **Управление блюдами** (CRUD операции)
- **Управление категориями** блюд
- **Обработка заказов** с изменением статусов
- **Модерация отзывов** пользователей
- **Аналитика и отчеты** по продажам

## Архитектура системы

### Тип архитектуры: **Монолит с модульной структурой**
![img.png](img/architecture.png)


## Технологический стек

### База данных:
- **PostgreSQL** - Основная БД
- **Flyway** - Миграции БД

### Инфраструктура:
- **Docker** - Контейнеризация
- **AWS S3** - Хранение изображений

## Схема базы данных

![img.png](../DB/img/db_image.png)

## API Endpoints

### Аутентификация (/api/v1/auth):
```
•	POST /register - Регистрация пользователя. Отправка кода верификации email.
•	POST /login - Вход в систему. Устанавливает пару access/refresh токенов в Cookie с флагом HttpOnly.
•	POST /refresh - Обновление access-токена по валидному refresh-токену.
•	POST /logout - Выход из системы. Инвалидирует refresh-токен и удаляет пару токенов из Cookie.
•	POST /change-password - Смена пароля (требует текущий пароль). (USER, ADMIN)
•	POST /send-verification - Отправка кода верификации email.
•	POST /verify-email - Подтверждение email по коду.
•	GET /me - Информация о текущем аутентифицированном пользователе. (USER, MODERATOR, ADMIN)
```

### Категории (/api/v1/categories):
```
•	GET / - Список всех категорий. Поддержка пагинации (?page=1&size=10).
•	GET /{id} - Детали категории по ID.
•	POST / - Создание новой категории. (ADMIN)
•	PUT /{id} - Обновление категории. (ADMIN)
•	DELETE /{id} - Удаление категории. (ADMIN)
```

### Блюда (/api/v1/dishes):
```
•	GET / - Список блюд. Поддержка фильтрации (?categoryId=5&vegetarian=true), пагинации и сортировки (?sortBy=price&sortOrder=asc).
•	GET /{id} - Детали блюда по ID.
•	POST / - Создание нового блюда. (MODERATOR, ADMIN)
•	PUT /{id} - Обновление блюда. (MODERATOR, ADMIN)
•	DELETE /{id} - Удаление блюда. (ADMIN) // Удаление часто оставляют только админу
•	PATCH /is_available/{id} – Обновление флага “В наличии” (MODERATOR, ADMIN)
•	POST /{id}/images - Загрузка изображения для блюда. (MODERATOR, ADMIN)
•	DELETE /{id}/images/{imageId} - Удаление конкретного изображения блюда. (MODERATOR, ADMIN)
```

### Корзина (/api/v1/cart):
```
•	GET / - Получить содержимое корзины текущего пользователя. (USER)
•	POST /items - Добавить блюдо (в теле запроса dishId и quantity). (USER)
•	PUT /items/{itemId}  - Изменить количество блюда в корзине. {itemId} - это ID записи в корзине. (USER)
•	DELETE /items/{itemId} - Удалить позицию из корзины. (USER)
•	DELETE / - Очистить всю корзину пользователя. (USER)
```

